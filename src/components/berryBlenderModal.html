<div class="modal fade noselect" id="berryBlenderModal" tabindex="-1" role="dialog"
     aria-labelledby="berryBlenderModal"
     style="cursor:default">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div>
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item" onclick="BlendingController.blendingModalTabSelected('blendingView')"><a data-toggle='tab' class='nav-link active' href="#blendingView">Blender</a></li>
                    <li class='nav-item' onclick="BlendingController.blendingModalTabSelected('blendingRecipeView')"><a data-toggle='tab' class='nav-link' href="#blendingRecipeView">Recipes</a></li>
                    <li class='nav-item' onclick="BlendingController.blendingModalTabSelected('blendingBuddiesView')"><a data-toggle='tab' class='nav-link' href="#blendingBuddiesView">Blending Buddies (TBD)</a></li>
                    <li class='nav-item' onclick="BlendingController.blendingModalTabSelected('blendHelpView')"><a data-toggle='tab' class='nav-link' href="#blendHelpView">Help</a></li>
                </ul>
            </div>

            <div class="modal-body tab-content p-0" style="overflow-x: hidden;">

                <div id="blendingView" class="tab-pane fade in active show">
                    
                    <div id="blenderView" class="justify-content-center no-select row">
                        
                        <div class="justify-content-center no-select col-12 col-lg-7">
                            <div class="berryBlendingListColumn mt-1 mb-1" style="overflow-y: auto;">
                                <table class="table table-hover table-sm">
                                    <thead class="thead-dark sticky-top">
                                        <tr>
                                            <th class="align-middle" rowspan="2">Berry</th>
                                            <th class="align-middle" colspan="5">Flavor</th>
                                            <th class="align-middle" rowspan="2">Smooth</th>
                                            <th class="align-middle" rowspan="2">Amount</th>
                                        </tr>
                                        <tr style="font-weight: bold;" data-bind="foreach: GameHelper.enumNumbers(FlavorType)">
                                            <td class="p-0 tight">
                                                <btn class="text-small btn btn-sm btn-block m-0" style="font-size: inherit; font-weight: inherit;"
                                                    data-bind="
                                                        attr: { for: 'btncheckBlend' + FlavorType[$data] },
                                                        css: { 'btn-info': BlendingController.flavorKeys[FlavorType[$data]](), 'btn-dark': !BlendingController.flavorKeys[FlavorType[$data]]() },
                                                        click: () => BlendingController.toggleFlavor($data),
                                                        text: FlavorType[$data]">
                                                </btn>
                                            </td>
                                        </tr>
                                    </thead>
                                    <tbody data-bind="foreach: FarmController.getFlavorFilteredBerryList(BlendingController.blendingListFlavorFilters())">
                                        <tr class="clickable"
                                            data-bind="
                                            click: function() { BlendingController.selectedBerry($data); },
                                            attr: { style: BlendingController.calculateTableRowCss($data) },
                                        ">
                                            <td style="justify-content: left;" data-bind="attr: {class: BlendingController.calculateTableBerryCss($data)}">
                                                <img height="30px" data-bind="attr: {src: FarmController.getBerryImage(App.game.farming.berryData[$data].type)}, css: { 'pokemon-not-seen': !App.game.farming.unlockedBerries[$data]() }"/>
                                                <span data-bind="text: App.game.farming.unlockedBerries[$data]() ? BerryType[$data] : ''"></span>
                                            </td>
                                            <!-- ko if: App.game.farming.unlockedBerries[$data]() -->
                                                <td class="align-middle" data-bind="text: App.game.farming.berryData[$data].flavors[0].value,
                                                style:{background: `rgb(238, 129, 48, ${App.game.farming.berryData[$data].flavors[0].value/100})`}">Spicy</td>
                                                <td class="align-middle" data-bind="text: App.game.farming.berryData[$data].flavors[1].value,
                                                style:{background: `rgb(99, 144, 240, ${App.game.farming.berryData[$data].flavors[1].value/100})`}">Dry</td>
                                                <td class="align-middle" data-bind="text: App.game.farming.berryData[$data].flavors[2].value,
                                                style:{background: `rgb(214, 133, 173, ${App.game.farming.berryData[$data].flavors[2].value/100})`}">Sweet</td>
                                                <td class="align-middle" data-bind="text: App.game.farming.berryData[$data].flavors[3].value,
                                                style:{background: `rgb(122, 199, 76, ${App.game.farming.berryData[$data].flavors[3].value/100})`}">Bitter</td>
                                                <td class="align-middle" data-bind="text: App.game.farming.berryData[$data].flavors[4].value,
                                                style:{background: `rgb(247, 208, 44, ${App.game.farming.berryData[$data].flavors[4].value/100})`}">Sour</td>
                                                <td class="align-middle" data-bind="text: App.game.farming.berryData[$data].smoothness"></td>
                                                <td class="align-middle" data-bind="text: App.game.farming.berryList[$data]().toLocaleString('en-US')"></td>
                                            <!-- /ko -->
                                            <!-- ko if: !App.game.farming.unlockedBerries[$data]() -->
                                                <td colspan="6">???</td>
                                                <td></td>
                                            <!-- /ko -->
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    
                        <div class="col-5">
                            <div data-bind="foreach: App.game.blending.machines">
                                <!-- ko if: $data.blendSlots.some(s => s.isUnlocked) -->
                                    <div class="mt-2 card-header p-0">
                                        <span data-bind="text: `Blender ${$index() + 1}`"></span>
                                    </div>
                                    <div>
                                        <div style="display: flex; flex-direction: row; justify-content: space-evenly;">
                                            <div>
                                                <div style="display: flex; flex-direction: row; justify-content: space-evenly;" data-bind="foreach: $data.blendSlots">
                                                    <!-- ko if: $data.isUnlocked -->
                                                    <div>
                                                        <div id="blendSlots" class="blendSlotsAnimated" data-bind="visible: !$data.isEmpty()"></div>
                                                        <div id="blendSlots" class="bg-secondary"
                                                            data-bind="ifnot: $data.isEmpty(),
                                                                click: function(data, event){App.game.blending.insertBerry($index(), BlendingController.selectedBerry(), $parentContext.$index())},
                                                                event: { contextmenu: function(data, event){App.game.blending.insertBerry($index(), BerryType.None, $parentContext.$index())} },">
                                                            <img width="100%" height="100%" src=""
                                                                data-bind="attr:{ src: FarmController.getBerryImage($parent.blendSlots[$index()].berry)}">
                                                        </div>
                                                    </div>
                                                    <!-- /ko -->
                                                </div>
                                                <table style="width: 100%;">
                                                    <tr>
                                                        <td colspan="5">Incoming Flavors:</td>
                                                    </tr>
                                                    <tr data-bind="foreach: App.game.blending.incomingFlavors($index())">
                                                        <td data-bind="text: FlavorType[$data.type]"></td>
                                                    </tr>
                                                    <tr data-bind="foreach: App.game.blending.incomingFlavors($index())">
                                                        <td data-bind="text: $data.value"></td>
                                                    </tr>
                                                </table>
                                            </div>
                                            <div style="display: flex; flex-direction:column; align-items: center; justify-content: center;">
                                                <div>
                                                    <img class="blenderBody" src="assets/images/contest/blenderBody.svg">
                                                    <img class="blenderTop" src="assets/images/contest/blenderTop.svg"
                                                        data-bind="attr: { style: 'rotate: ' + App.game.blending.machines[$index()].degreesRotated +'deg' }"
                                                    >
                                                </div>
                                                <div>
                                                    <div data-bind="text: `RPM: ${App.game.blending.getRPMDisplay($index())}`"></div>
                                                    <div class="progress">
                                                        <div class="progress-bar bg-success" role="progressbar"
                                                            data-bind="attr:{ style: 'width:' + App.game.blending.getTimer($index()) + '%' }"
                                                            aria-valuemin="0" aria-valuemax="100">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <!-- /ko -->
                            </div>
                                <!-- ko if: App.game.blending.machines.some(m => m.blendSlots.some(s => !s.isUnlocked)) -->
                                    <button class="clickable btn btn-block btn-success" onclick="App.game.blending.buyBlendingSlot()" data-bind="
                                        css: {disabled: App.game.wallet.currencies[GameConstants.Currency.contestToken]() < App.game.blending.nextBlendingSlotCost().amount},
                                        ">
                                        <span data-bind="html: App.game.blending.getBlendingSlotCostDisplay()"</span>
                                    </button>
                                <!-- /ko -->
                            <div class="mt-3">
                                <table style="width: 100%; table-layout:fixed;">
                                    <tr class="text-light">
                                    <th class="bg-dark" colspan="5">Flavor Bank</th>
                                    </tr>
                                    <tr>
                                        <td>Spicy</td>
                                        <td>Dry</td>
                                        <td>Sweet</td>
                                        <td>Bitter</td>
                                        <td>Sour</td>
                                    </tr>
                                    <tr>
                                    <td data-bind="text: GameHelper.formatAmount(App.game.blending.flavorBank[0]())">Spicy</td>
                                    <td data-bind="text: GameHelper.formatAmount(App.game.blending.flavorBank[1]())">Dry</td>
                                    <td data-bind="text: GameHelper.formatAmount(App.game.blending.flavorBank[2]())">Sweet</td>
                                    <td data-bind="text: GameHelper.formatAmount(App.game.blending.flavorBank[3]())">Bitter</td>
                                    <td data-bind="text: GameHelper.formatAmount(App.game.blending.flavorBank[4]())">Sour</td>
                                </tr>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>

                <div id="blendingRecipeView" class="tab-pane fade">
                </div>

                <div id="blendingBuddiesView" class="tab-pane fade">
                    <h4><u>Blending Buddies</u></h4>
                    <p>Blending Buddies will be able to join in and offer a random Berry from their pool to the Machine they're assigned to. Each Buddy will also contribute their own RPM to the Machine.</p>
                    <p>The berry pool of each Buddy is planned be based on berry generation.</p>
                </div>

                <div id="blendHelpView" class="tab-pane fade col-10 offset-1">
                    <h4><u>Berry Blending</u></h4>
                    <p>Blend Berries to convert them into Flavor Values, which can be used to make Pokeblocks.</p>
                    <p>
                        Place berries in slots to extract their flavor values into your Flavor Bank.
                        Each berry has a smoothness value that contributes to how fast all the berries in a machine are processed into flavor points.
                        This is called RPM.
                        The base RPM of each machine is based off the average smoothness of all berries inside its slots, but bonus RPM can be attained from synergizing berries to specialize in a flavor.
                        Combine different berries to get more RPM and blend faster results!
                    </p>
                    <p>
                        Click on a slot to insert the selected berry.
                        To remove a berry from a slot, click on it with the same berry selected or right click it with any berry selected.
                        Berries will automatically be ejected when their amount reaches the specified <i>Stopping Amount</i>.
                        You cannot use berries if you have less than your <i>Stopping Amount</i>.
                    </p>
                    <p>
                        You can have up to four machines, with four blending slots on each.
                        Unlock more Blending Slots and machines with Contest Tokens.
                        You can earn more Contest Tokens by participating in Contests in Hoenn or the Bug Catching Contest in Johto.
                    </p>

                    <h4><u>Recipes</u></h4>
                    <p>
                        Recipes let you create Pokeblocks with the flavors in your Flavor Bank.
                        They can be unlocked through progressing in the game or bought in Towns that hold Contests.
                    </p>

                    <h4><u>Blending Buddies</u></h4>
                    <p>
                        Blending Buddies can join in and offer a random Berry from their pool to the Machine they're assigned to.
                        They act like a fifth Blending Slot and affect the RPM and flavor output of a machine.
                    </p>
                </div>
            </div>

            <div class="modal-footer">
                <div class="row justify-content-center" data-bind="visible: BlendingController.blendingModalTabSelected() === 'blendingView'">
                    <div class="input-group m-0 ">
                        <div class="input-group-prepend">
                            <button class="btn btn-info smallButton smallFont" style="pointer-events: none;">
                                Stop at Berry Amount:
                            </button>
                        </div>
                        <input id="berriesToBlendAmount" type="number" class="outline-dark form-control form-control-number"
                            min="0" required name="berriesToBlendAmount"
                            oninput="App.game.blending.berriesToBeBlended(parseInt($(this).val().toString(), 10) || 0);"
                            onchange="App.game.blending.berriesToBeBlended(parseInt($(this).val().toString(), 10) || 0);" title=""
                            data-bind="value: App.game.blending.berriesToBeBlended()"/>
                    </div>
                </div>
                <div class="row justify-content-center" data-bind="visible: BlendingController.blendingModalTabSelected() === 'blendingView'">
                    <div class="input-group m-0">
                        <div class="input-group-prepend">
                            <button type="button" class="btn btn-primary" onclick="App.game.blending.insertBerryAll(BlendingController.selectedBerry())"
                                data-bind="css: {disabled: !App.game.blending.hasEnoughBerries(BlendingController.selectedBerry()) }">
                                Fill All Empty Slots
                            </button>
                        </div>
                        <div class="input-group-append">
                            <button id="blendBerryButton" class="btn btn-sm btn-primary px-1 py-1" onclick="BlendingController.berrySpin()">
                                <img id="blendBerry" height="28px" data-bind="
                                    attr: { src: FarmController.getBerryImage(BlendingController.selectedBerry()) }"/>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="justify-content-center m-0" data-bind="visible: BlendingController.blendingModalTabSelected() === 'blendingView'">
                    <button type="button" class="btn btn-primary m-1" onclick="App.game.blending.removeBerryAll()">
                        Clear All Slots
                    </button>
                </div>

                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>


        </div>
    </div>
</div>

