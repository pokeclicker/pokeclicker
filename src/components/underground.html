<div aria-labelledby="myModalLabel" class="modal fade noselect" id="mineModal" role="dialog"
     style="cursor:default" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header p-0">
                <ul class="nav nav-tabs nav-fill w-100">
                    <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#dig">Dig</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#treasures">Treasures</a></li>
                    <li class="nav-item"><a data-toggle='tab' class='nav-link' href="#undergroundHelpers">Experts</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#help">Help</a></li>
                    <li class="d-block"><button type="button" class="btn btn-danger" data-dismiss="modal" style="font-size: 18px; font-weight: 700;">×</button></li>
                </ul>
            </div>
            <div class="modal-body tab-content p-0">
                <div id="dig" class="tab-pane fade in active show" data-bind="">
                    <div class="container">
                        <div class="row p-2">
                            <div class="col-6 p-0 d-flex">
                                <button class="btn btn-primary" data-bind="click: () => $('#findNewMineModal').modal('show');">Find mine</button>

                                <!-- ko let: { autoRestartUndergroundMine: Settings.getSetting('autoRestartUndergroundMine') } -->
                                <button class="btn btn-danger p-2" style="min-width: 36px;" data-bind="
                                    text: `↻ ${autoRestartUndergroundMine.observableValue() ? 'On' : 'Off'}`,
                                    css: {
                                        'btn-danger': !autoRestartUndergroundMine.observableValue(),
                                        'btn-success': autoRestartUndergroundMine.observableValue()
                                    },
                                    tooltip: {
                                        title: `${autoRestartUndergroundMine.displayName}: ${autoRestartUndergroundMine.observableValue() ? 'On' : 'Off'}`,
                                        trigger: 'hover',
                                        placement:'right'
                                    },
                                    click: () => autoRestartUndergroundMine.observableValue(!autoRestartUndergroundMine.observableValue())"></button>
                                <!-- /ko -->
                            </div>

                            <div class="col-6 p-0" data-bind="tooltip: {
                                    title: `${(App.game.underground.undergroundExp - Underground.convertLevelToExperience(App.game.underground.undergroundLevel)).toLocaleString('en-US')} / ${(Underground.convertLevelToExperience(App.game.underground.undergroundLevel + 1) - Underground.convertLevelToExperience(App.game.underground.undergroundLevel)).toLocaleString('en-US')}`,
                                    trigger: 'hover'
                                }">
                                <div>Lvl. <knockout data-bind="text: App.game.underground.undergroundLevel"></knockout></div>
                                <div class="progress" style='height: 5px'>
                                    <div class="progress-bar bg-info" role="progressbar"
                                         data-bind="attr:{ style: 'width:' + App.game.underground.progressToNextLevel.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                         aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ko if: App.game.underground.mine -->
                    <div class="underground-mining-container p-2 p-lg-2">
                        <!-- Treasure count -->
                        <div class="card underground-mining-container__treasure-count">
                            <div class="card-body p-2 d-flex justify-content-center" style="gap: 1.5rem">
                                <!-- ko if: !App.game.underground.mine || App.game.underground.mine.timeUntilDiscovery > 0 -->
                                <div>Collected • ??</div>
                                <div>Seen • ??</div>
                                <div>Buried • ??</div>
                                <!-- /ko -->

                                <!-- ko ifnot: !App.game.underground.mine || App.game.underground.mine.timeUntilDiscovery > 0 -->
                                <div class="" data-bind="css: { 'text-warning': App.game.underground.mine?.itemsFound > 0 && App.game.underground.mine?.itemsFound < App.game.underground.mine?.itemsBuried, 'text-success': App.game.underground.mine?.itemsFound === App.game.underground.mine?.itemsBuried }">
                                    Collected • <knockout data-bind="text: App.game.underground.mine?.itemsFound"></knockout>
                                </div>
                                <div class="" data-bind="css: { 'text-warning': App.game.underground.mine?.itemsPartiallyFound > 0 && App.game.underground.mine?.itemsPartiallyFound < App.game.underground.mine?.itemsBuried, 'text-success': App.game.underground.mine?.itemsPartiallyFound === App.game.underground.mine?.itemsBuried }">
                                    Seen • <knockout data-bind="text: App.game.underground.mine?.itemsPartiallyFound"></knockout>
                                </div>
                                <div class="">
                                    Buried • <knockout data-bind="text: App.game.underground.mine?.itemsBuried"></knockout>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>

                        <!-- Mine -->
                        <div class="underground-mining-container__mine position-relative">
                            <div class="position-relative">
                                <div id="mineBody" style="margin:auto; background-image: url('assets/images/underground/rock0.png');"
                                     data-bind="css: {
                                        'disabled': App.game.underground.mine.timeUntilDiscovery > 0 || App.game.underground.mine.completed,
                                        'tool-cooldown': !App.game.underground.tools.getTool(App.game.underground.tools.selectedToolType).canUseTool()
                                     },
                                     class: `${UndergroundToolType[App.game.underground.tools.selectedToolType]}Selected`,
                                     style: {
                                        backgroundSize: `calc(100% / ${App.game.underground.mine?.width})`,
                                        gridTemplateColumns: `repeat(${App.game.underground.mine?.width}, 1fr)`
                                     }">
                                    <!-- ko foreach: App.game.underground.mine.grid -->
                                    <div class="mineSquare" data-bind="event: { mousedown: () => UndergroundController.clickModalMineSquare($index()) }">
                                        <div class="rock" data-bind="class: `rock${$data.layerDepth}`, style: UndergroundController.calculateMineTileStyle($index())"></div>

                                        <!-- ko if: $data.survey > 0 -->
                                        <div class="survey" data-bind="class: `survey-${$data.survey}`"></div>
                                        <!-- /ko -->
                                    </div>
                                    <!-- /ko -->
                                </div>

                                <!-- ko if: App.game.underground.mine && App.game.underground.mine.timeUntilDiscovery > 0 -->
                                <div style="position: absolute; inset: 20%; display: grid; align-content: center;">
                                    <div>Searching for mine</div>
                                    <div class="progress" style='height: 5px'>
                                        <div class="progress-bar bg-info" role="progressbar"
                                             data-bind="attr:{ style: 'width:' + (1 - App.game.underground.mine.timeUntilDiscovery / App.game.underground.mine.initialTimeToDiscover).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                             aria-valuemin="0" aria-valuemax="100">
                                        </div>
                                    </div>
                                    <div data-bind="text: GameConstants.formatTime(App.game.underground.mine.timeUntilDiscovery)"></div>
                                </div>
                                <!-- /ko -->

                                <!-- ko if: App.game.underground.mine && App.game.underground.mine.completed -->
                                <div style="position: absolute; inset: 20%; display: grid; gap: 1rem; align-content: center;">
                                    <div>Collected all treasures</div>
                                    <button class="btn btn-primary" data-bind="click: () => $('#findNewMineModal').modal('show');">Find mine</button>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>

                        <!-- Tools -->
                        <div class="underground-mining-container__tools">
                            <div class="underground-all-tools-container">
                                <!-- ko foreach: App.game.underground.tools.tools -->
                                <div class="underground-tool-container underground-tool-color clickable" data-bind="
                                    class: `underground-tool-color__${UndergroundToolType[$data.id].toLowerCase()}`,
                                    click: () => App.game.underground.tools.selectedToolType = $data.id
                                ">
                                    <div class="card-body bg-secondary rounded border border-secondary text-center p-1" data-bind="css: { 'border-info': App.game.underground.tools.selectedToolType === $data.id }">
                                        <div class="underground-tool__background-gradient" data-bind="css: { 'conic': $data.durabilityPerUse > 0, 'infinite': $data.durabilityPerUse === 0 }, style: { '--gradient-percentage': $data.durability.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }">
                                            <div class="bg-secondary p-1 p-xl-2">
                                                <img alt="" data-bind="attr: { src: `assets/images/underground/${UndergroundToolType[$data.id]}.png` }">
                                                <div class="small font-weight-bold" data-bind="css: { 'text-warning': $data.durability < $data.durabilityPerUse }">
                                                    <knockout data-bind="text: $data.durability.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 0, maximumFractionDigits: 0 })"></knockout>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="small" data-bind="
                                            text: $data.durabilityPerUse === 0 ? '∞' : `${Math.floor($data.durability / $data.durabilityPerUse)}`,
                                            css: {
                                                'text-success': $data.durabilityPerUse === 0 || (1 - $data.durability) <= 1 % $data.durabilityPerUse,
                                                'text-warning': Math.floor($data.durability / $data.durabilityPerUse) === 0
                                            }
                                        "></div>
                                    </div>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>

                        <!-- Battery -->
                        <div class="underground-mining-container__cell-battery">
                            <div class="d-flex">
                                <div class="flex-grow-1 underground-all-tools-container">
                                    <div class="underground-tool-container underground-tool-color underground-tool-color__discharge" data-bind="
                                        css: { 'clickable': App.game.underground.battery.canDischarge() },
                                        click: () => { App.game.underground.battery.discharge() }
                                    ">
                                        <div class="card-body bg-secondary rounded border border-secondary text-center p-1">
                                            <div class="underground-tool__background-gradient conic" data-bind="style: { '--gradient-percentage': Math.min(App.game.underground.battery.charges / App.game.underground.battery.maxCharges, 1).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }">
                                                <div class="bg-secondary p-1 p-xl-2">
                                                    <img alt="" width="27px" data-bind="attr:{ src: 'assets/images/oakitems/' + OakItemType[OakItemType.Cell_Battery] + '.png'}">
                                                    <div class="small font-weight-bold">
                                                        <knockout data-bind="text: Math.min(App.game.underground.battery.charges, App.game.underground.battery.maxCharges), css: { 'text-warning': App.game.underground.battery.charges < App.game.underground.battery.maxCharges }"></knockout> / <knockout data-bind="text: App.game.underground.battery.maxCharges"></knockout>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="small" data-bind="">Click to Discharge (<knockout data-bind="text: Settings.getSetting('hotkey.underground.discharge')?.value"></knockout>)</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Active tool info -->
                        <!-- ko let: { tool: App.game.underground.tools.getTool(App.game.underground.tools.selectedToolType) } -->
                        <div class="card underground-mining-container__tool-info">
                            <div class="card-header p-2 font-weight-bold" data-bind="text: `${tool.displayName} (${Settings.getSetting('hotkey.underground.' + UndergroundToolType[tool.id].toLowerCase())?.value})`"></div>

                            <div class="card-body p-2">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-12 col-lg-5 mb-2">
                                            <table class="table table-striped table-hover table-bordered table-sm m-0">
                                                <thead>
                                                <tr class="bg-secondary">
                                                    <th colspan="2">Info</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <!-- ko if: tool.durabilityPerUse > 0 -->
                                                <tr>
                                                    <td class="text-left">Next use</td>
                                                    <td class="text-left tight"><code data-bind="text: GameConstants.formatTime(Math.max(tool.durabilityPerUse - tool.durability, 0) / tool.restoreRatePerSecond())"></code></td>
                                                </tr>
                                                <tr>
                                                    <td class="text-left">Time until 100%</td>
                                                    <td class="text-left tight"><code data-bind="text: GameConstants.formatTime((1 - tool.durability) / tool.restoreRatePerSecond())"></code></td>
                                                </tr>
                                                <tr>
                                                    <td class="text-left">Durability per use</td>
                                                    <td class="text-left tight"><code data-bind="text: tool.durabilityPerUse === 0 ? 'Free' : tool.durabilityPerUse.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 0, maximumFractionDigits: 2 })"></code></td>
                                                </tr>
                                                <!-- /ko -->

                                                <!-- ko ifnot: tool.durabilityPerUse > 0 -->
                                                <tr>
                                                    <td colspan="2" class="text-center">Your restore rate has grown so much that this tool has now become free to use.</td>
                                                </tr>
                                                <!-- /ko -->

                                                <tr>
                                                    <td class="text-left">Lifetime usage</td>
                                                    <td class="text-left tight"><code data-bind="text: App.game.statistics.undergroundToolsUsed[tool.id]().toLocaleString('en-US')"></code></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="col-12 col-lg-7">
                                            <p class="small text-left m-0" data-bind="text: tool.description"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                    <!-- /ko -->
                </div>

                <div id="treasures" class="tab-pane fade p-3">
                    <div class="row">
                        <div class="col-12 d-lg-none d-block">
                            <button class="w-100 my-1 btn btn-secondary" type="button" data-toggle="collapse"
                            data-target="#underground-treasure-filter-container" aria-expanded="false" aria-controls="underground-treasure-filter-container">
                                Filters and Settings
                            </button>
                        </div>

                        <div class="col-lg-3 col-12 collapse dont-collapse-lg" id="underground-treasure-filter-container">
                            <div class="d-none d-lg-block">
                                <h4>Filters and Settings</h4>
                            </div>

                            <hr>

                            <div class="row no-gutters text-left">
                                    <div class="form-group col-12">
                                        <div class="btn-group btn-group-toggle w-100">
                                            <label class="btn btn-secondary" data-bind="css: { active: Settings.getSetting('undergroundTreasureViewMode').observableValue() === 'list-view' }">
                                                <input type="radio" name="treasure-view-mode" value="list-view" onchange="Settings.setSettingByName('undergroundTreasureViewMode', this.value)">
                                                List
                                            </label>
                                            <label class="btn btn-secondary" data-bind="css: { active: Settings.getSetting('undergroundTreasureViewMode').observableValue() === 'grid-view' }">
                                                <input type="radio" name="treasure-view-mode" value="grid-view" onchange="Settings.setSettingByName('undergroundTreasureViewMode', this.value)">
                                                Grid
                                            </label>
                                        </div>
                                    </div>

                                    <div class="form-group col-12">
                                        <!-- ko let: { groupTreasuresByType: Settings.getSetting('undergroundTreasureDisplayGrouping') } -->
                                        <label for="group-treasures-by-type" data-bind="text: groupTreasuresByType.displayName"></label>
                                        <select id="group-treasures-by-type" autocomplete="off" class="custom-select"
                                                data-bind="options: groupTreasuresByType.options,
                                                                        optionsValue: 'value',
                                                                        optionsText: 'text',
                                                                        value: groupTreasuresByType.observableValue">
                                        </select>
                                        <!-- /ko -->
                                    </div>

                                    <div class="form-group col-12">
                                        <!-- ko let: { undergroundTreasureDisplaySorting: Settings.getSetting('undergroundTreasureDisplaySorting') } -->
                                        <label for="underground-treasure-display-sorting" data-bind="text: undergroundTreasureDisplaySorting.displayName">Sort</label>
                                        <div class="input-group">
                                            <select id="underground-treasure-display-sorting" autocomplete="off" class="custom-select"
                                                    data-bind="options: undergroundTreasureDisplaySorting.options,
                                                                optionsValue: 'value',
                                                                optionsText: 'text',
                                                                value: undergroundTreasureDisplaySorting.observableValue">
                                            </select>
                                            <div class="input-group-append bg-primary text-light">
                                                <!-- ko let: { undergroundTreasureDisplaySortingDirection: Settings.getSetting('undergroundTreasureDisplaySortingDirection') } -->
                                                <label for="underground-treasure-display-sorting-direction" class="clickable m-0 pl-2 pr-2" style="font-size: 22px;"
                                                       data-bind="text: undergroundTreasureDisplaySortingDirection.observableValue() ? '⥄' : '⥂',
                                                                    tooltip: {
                                                                        title: undergroundTreasureDisplaySortingDirection.observableValue() ? 'Descending (highest value first)' : 'Ascending (lowest value first)',
                                                                        trigger: 'hover',
                                                                        placement:'top'
                                                                    }">
                                                    ⥂
                                                </label>
                                                <input id="underground-treasure-display-sorting-direction" style="vertical-align: middle" class="hidden" type='checkbox'
                                                       data-bind="checked: undergroundTreasureDisplaySortingDirection.observableValue"/>
                                                <!-- /ko -->
                                            </div>
                                        </div>
                                        <!-- /ko -->
                                    </div>

                                    <div class="form-group col-12">
                                        <!-- ko let: { undergroundTreasureDisplayShowLocked: Settings.getSetting('undergroundTreasureDisplayShowLocked') } -->
                                        <label class="small" for="underground-treasure-display-show-locked" data-bind="text: undergroundTreasureDisplayShowLocked.displayName"></label>
                                        <label class="form-check-label toggler-wrapper style-1 float-right">
                                            <input class="form-check-input" type="checkbox" id="underground-treasure-display-show-locked"
                                                   data-bind="checked: undergroundTreasureDisplayShowLocked.observableValue">
                                            <div class="toggler-slider">
                                                <div class="toggler-knob"></div>
                                            </div>
                                        </label>
                                        <!-- /ko -->
                                    </div>

                                    <hr>

                                    <div class="form-group col-12">
                                        <button type="button" class="btn btn-primary btn-block" data-bind="
                                            click: () => UndergroundTrading.quickSellEnabled(!UndergroundTrading.quickSellEnabled()),
                                            text: `${UndergroundTrading.quickSellEnabled() ? 'Disable' : 'Enable'} Quick-Sell Mode`,
                                            tooltip: {
                                                title: 'With Quick-Sell Mode enabled, clicking an item sells all of it instantly',
                                                placement: 'top',
                                                trigger: 'hover',
                                            }
                                        ">
                                            Quick-Sell Mode
                                        </button>
                                    </div>
                                </div>
                        </div>

                        <div class="col-lg-9 col-12">
                            <p data-bind="ifnot: UndergroundTrading.quickSellEnabled()">Click on your treasure to open up a detail view</p>
                            <p data-bind="if: UndergroundTrading.quickSellEnabled()">
                                <label class="h3 text-danger font-weight-bold">Quick-Sell Mode enabled</label><br/>
                                Clicking your treasure will sell your entire stash of that item.
                            </p>

                            <!-- ko foreach: UndergroundController.organisedTreasuresList -->
                            <div class="card mb-2">
                                <div class="card-header d-flex align-items-center p-0">
                                    <span class="flex-grow-1 text-center font-weight-bold" data-bind="text: $data.title"></span>
                                </div>

                                <div class="card-body p-2">
                                    <div class="justify-content-center treasure-item-container" data-bind="
                                        class: Settings.getSetting('undergroundTreasureViewMode').observableValue(),
                                        css: { quickSellMode: UndergroundTrading.quickSellEnabled() }
                                    ">
                                        <!-- ko foreach: $data.treasures -->
                                        <div data-bind="
                                            template: { name: 'undergroundTreasureItemTemplate', data: { undergroundItem: $data, highlight: false } },
                                            click: () => {
                                                if ($data.isUnlocked()) {
                                                    if (UndergroundTrading.quickSellEnabled()) {
                                                        UndergroundTrading.quickSell($data);
                                                    }
                                                    else {
                                                        UndergroundTrading.selectedTradeFromItem = $data;
                                                        UndergroundTrading.selectedTradeToItem = UndergroundTrading.tradeToItemList[0];
                                                        $('#treasureDetailModal').modal('show');
                                                    }
                                                }
                                            }
                                        "></div>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>
                            <!-- /ko -->
                        </div>
                    </div>
                </div>

                <div id="undergroundHelpers" class="tab-pane fade">
                    <div class="row m-0 justify-content-start" data-bind="foreach: App.game.underground.helpers.available()" style="max-width: 100%;">
                        <div class="card border-0 text-left col-12 col-sm-6 col-lg-4 p-1">
                            <h5 class="card-header d-flex align-items-center justify-content-between">
                                <knockout data-bind="text: $data.name">Name</knockout>
                                <div class="d-flex align-items-center position-relative">
                                    <!-- ko foreach: $data.images -->
                                    <img class="pixelated" data-bind="attr: { src: $data }" src="" alt="">
                                    <!-- /ko -->
                                    <!-- ko if: $data.hasStolenItem(600) -->
                                    <img class="pixelated position-absolute" src="assets/images/pokemon/25.23.png" alt="" style="width: 24px; right: -16px; bottom: -10px;">
                                    <!-- /ko -->
                                </div>
                            </h5>
                            <div class="card-body p-0">
                                <table class="table table-striped table-hover table-bordered table-sm m-0">
                                    <thead>
                                    <tr>
                                        <th colspan="2" class="text-center text-light bg-dark"><h5 class="m-0">Information</h5></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td class="text-left">Level</td>
                                        <td class="text-center tight" data-bind="text: $data.level.toLocaleString('en-US')"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <div class="progress" style='height: 5px'>
                                                <div class="progress-bar bg-info" role="progressbar"
                                                     data-bind="style: { 'width': $data.progressToNextLevel.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                                     aria-valuemin="0" aria-valuemax="100">
                                                    <span data-bind="text: `${($data.experience - UndergroundHelper.convertLevelToExperience($data.level)).toLocaleString('en-US')} / ${(UndergroundHelper.convertLevelToExperience($data.level + 1) - UndergroundHelper.convertLevelToExperience($data.level)).toLocaleString('en-US')}`"></span>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Expertise</td>
                                        <td class="text-center tight" data-bind="text: UndergroundController.getMineConfig($data.favoriteMine).displayName"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Discover chance</td>
                                        <td class="text-center tight" data-bind="text: $data.favoriteMineChance.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Use Expertise</td>
                                        <td class="text-center tight align-middle">
                                            <input class="clickable" type="checkbox" data-bind="checked: $data.shouldDiscoverFavorite"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Smart tool use</td>
                                        <td class="text-center tight" data-bind="text: $data.smartToolUsageChance.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Reward retention</td>
                                        <td class="text-center tight" data-bind="text: $data.rewardRetention.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Work cycle</td>
                                        <td class="text-center tight" data-bind="text: `${$data.workCycleTime.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })}s`"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <div class="d-flex flex-wrap justify-content-center" style="gap: 1rem;">
                                                <!-- ko foreach: GameHelper.enumNumbers(GameConstants.EnergyRestoreSize) -->
                                                <div class="d-flex flex-column align-items-center clickable" data-bind="click: () => { $parent.toggleEnergyRestore($data); }">
                                                    <img class="pixelated" src="" alt="" style="height: 26px;" data-bind="
                                                        attr: { src: ItemList[GameConstants.EnergyRestoreSize[$data]].image },
                                                        style: { opacity: $parent.hasAllowedEnergyRestore($data) ? 1 : 0.3 }
                                                    ">
                                                    <div class="small" data-bind="text: `${ItemList[GameConstants.EnergyRestoreSize[$data]].displayName.replace(' Restore', '')} [${player.itemList[GameConstants.EnergyRestoreSize[$data]]().toLocaleString('en-US', { notation: 'compact' })}]`"></div>
                                                </div>
                                                <!-- /ko -->
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="card-footer p-0">
                                <button class="btn btn-block" data-bind="attr: { disabled: !$data.hired && !App.game.underground.helpers.canHire() }, css: { 'btn-success': !$data.hired, 'btn-danger': $data.hired }, click: () => !$data.hired ? $data.hire() : $data.fire(), text: !$data.hired ? 'Hire!' : 'Fire!'">Hire!</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="help" class="tab-pane fade p-2 text-left">
                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Mines</span>
                        </div>

                        <div class="card-body">
                            <p>
                                There are six different types of mines you can search for in the Underground.
                                Understanding their unique properties and the discovery times involved is crucial for efficient mining.
                                The Underground Glossary can be found at the bottom of this page.
                            </p>

                            <h4>Mine Types</h4>
                            <ul>
                                <li>
                                    <strong><knockout data-bind="text: MineConfigs.find(MineType.Random).displayName"></knockout>:</strong> Contains all possible treasures (except the treasure found in a <knockout data-bind="text: MineConfigs.find(MineType.Special).displayName"></knockout>)
                                </li>
                                <li>
                                    <strong><knockout data-bind="text: MineConfigs.find(MineType.Diamond).displayName"></knockout>:</strong> Contains only treasures that can be sold for diamonds.
                                </li>
                                <li>
                                    <strong><knockout data-bind="text: MineConfigs.find(MineType.GemPlate).displayName"></knockout>:</strong> Contains only gem plate treasures that can be sold for gems.
                                </li>
                                <li>
                                    <strong><knockout data-bind="text: MineConfigs.find(MineType.Shard).displayName"></knockout>:</strong> Contains only shard treasures.
                                </li>
                                <li>
                                    <strong><knockout data-bind="text: MineConfigs.find(MineType.Fossil).displayName"></knockout>:</strong> Contains only fossils and fossil pieces.
                                </li>
                                <li>
                                    <strong><knockout data-bind="text: MineConfigs.find(MineType.EvolutionItem).displayName"></knockout>:</strong> Contains only evolution items.
                                </li>
                                <li>
                                    <strong><knockout data-bind="text: MineConfigs.find(MineType.Special).displayName"></knockout>:</strong> Can only be found when special conditions are met (see below). Contains only special items.
                                </li>
                            </ul>

                            <h4><knockout data-bind="text: MineConfigs.find(MineType.Special).displayName"></knockout></h4>
                            <p>
                                When you (not your expert) are searching for a mine, there is a 4% chance for the mine to be a <knockout data-bind="text: MineConfigs.find(MineType.Special).displayName"></knockout>.
                                This mine only contains 1 treasure, which can be any of the mega stones (if eligible) or other special treasures.
                                <br>
                                <i>Note: The auto-restart triggered by the player digging up the last item <u>can</u> trigger a <knockout data-bind="text: MineConfigs.find(MineType.Special).displayName"></knockout>.</i>
                            </p>

                            <h4>Finding a new mine</h4>
                            <p>
                                A new mine can be manually found by clicking the Find mine button in the Dig tab.<br/>
                                Automatically starting a new mine happens in the following cases:
                            </p>
                            <ul>
                                <li>A <strong>player</strong> digs up the last treasure: When the 'Auto restart selected mine' toggle is enabled, the game will automatically try to find a new mine of your selected type.</li>
                                <li>An <strong>expert</strong> digs up the last treasure: If your expert has the 'Use expertise' setting enabled, it will try to find a specific mine. If this setting is disabled it will find a <knockout data-bind="text: MineConfigs.find(MineType.Random).displayName"></knockout>.</li>
                            </ul>
                            <p>
                                <i>Note: This step happens before calculating a potential discovery time</i>
                            </p>

                            <h4>Discovery Time Calculation</h4>
                            <p>The discovery time is calculated as follows:</p>
                            <ul>
                                <li>
                                    <strong><knockout data-bind="text: MineConfigs.find(MineType.Random).displayName"></knockout></strong>
                                    <ul>
                                        <li>Current mine is not a <knockout data-bind="text: MineConfigs.find(MineType.Random).displayName"></knockout>: No discovery time</li>
                                        <li>
                                            Current mine is a <knockout data-bind="text: MineConfigs.find(MineType.Random).displayName"></knockout>:<br/>
                                            The discovery time starts at <knockout data-bind="text: GameConstants.formatTimeFullLetters(GameConstants.DISCOVER_MINE_TIMEOUT_BASE)"></knockout> and is reduced by <knockout data-bind="text: GameConstants.formatTimeFullLetters(GameConstants.DISCOVER_MINE_TIMEOUT_REDUCTION_PER_LEVEL)"></knockout> for every level past level <knockout data-bind="text: GameConstants.DISCOVER_MINE_TIMEOUT_LEVEL_START"></knockout>. This is then further reduced as you discover treasures in your current mine.
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <strong>Other Mine Type</strong>
                                    <p>The discovery time starts at <knockout data-bind="text: GameConstants.formatTimeFullLetters(GameConstants.DISCOVER_MINE_TIMEOUT_BASE)"></knockout> and is reduced by <knockout data-bind="text: GameConstants.formatTimeFullLetters(GameConstants.DISCOVER_MINE_TIMEOUT_REDUCTION_PER_LEVEL)"></knockout> for every level past level <knockout data-bind="text: GameConstants.DISCOVER_MINE_TIMEOUT_LEVEL_START"></knockout>.</p>
                                </li>
                            </ul>

                            <h4>Amount of Treasure</h4>
                            <p>The amount of treasure a player can find is random, between the minimum (inclusive) and maximum (inclusive), and increases as their Underground Level increases:</p>
                            <table class="table table-sm table-striped text-center">
                                <thead class="thead-dark">
                                <tr>
                                    <th scope="col">Level</th>
                                    <th scope="col">Minimum</th>
                                    <th scope="col">Maximum</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>1-2</td>
                                    <td>1</td>
                                    <td>3</td>
                                </tr>
                                <tr>
                                    <td>3-5</td>
                                    <td>2</td>
                                    <td>3</td>
                                </tr>
                                <tr>
                                    <td>6-8</td>
                                    <td>2</td>
                                    <td>4</td>
                                </tr>
                                <tr>
                                    <td>9-11</td>
                                    <td>3</td>
                                    <td>4</td>
                                </tr>
                                <tr>
                                    <td>12-14</td>
                                    <td>3</td>
                                    <td>5</td>
                                </tr>
                                <tr>
                                    <td>15-17</td>
                                    <td>4</td>
                                    <td>5</td>
                                </tr>
                                <tr>
                                    <td>18-20</td>
                                    <td>4</td>
                                    <td>6</td>
                                </tr>
                                <tr>
                                    <td>21-23</td>
                                    <td>5</td>
                                    <td>6</td>
                                </tr>
                                <tr>
                                    <td>24-26</td>
                                    <td>5</td>
                                    <td>7</td>
                                </tr>
                                <tr>
                                    <td>27-29</td>
                                    <td>6</td>
                                    <td>7</td>
                                </tr>
                                <tr>
                                    <td>30+</td>
                                    <td>6</td>
                                    <td>8</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Tools</span>
                        </div>

                        <div class="card-body">
                            <p>The Underground offers <knockout data-bind="text: App.game.underground.tools.tools.length"></knockout> powerful tools to aid in your mining and exploration. Each tool has a unique function, and understanding how to use them effectively is crucial for maximizing your mining efficiency.</p>

                            <h4>Durability</h4>
                            <p>
                                Using a tool is only possible when your tool is durable enough.
                                When you use your tool successfully it will remove some of its durability, which will be restored over time.
                            </p>
                            <p>
                                The restore rate of your tools depends on your Underground level.
                            </p>

                            <h4>Tools Overview</h4>
                            <p>There are <knockout data-bind="text: App.game.underground.tools.tools.length"></knockout> different tools available, each with unique functions:</p>
                            <table class="table table-sm table-striped">
                                <thead class="thead-dark">
                                <tr>
                                    <th colspan="2" class="text-center">Tool</th>
                                    <th>Description</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- ko foreach: App.game.underground.tools.tools -->
                                <tr>
                                    <td class="vertical-middle">
                                        <img alt="" data-bind="attr: { src: `assets/images/underground/${UndergroundToolType[$data.id]}.png` }">
                                    </td>
                                    <td class="vertical-middle text-left" data-bind="text: $data.displayName"></td>
                                    <td class="vertical-middle text-left" data-bind="text: $data.description"></td>
                                </tr>
                                <!-- /ko -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Oak Items</span>
                        </div>

                        <div class="card-body">
                            <h4>Explosive Charge</h4>
                            <ul>
                                <li><strong>Progress:</strong> Gains progress to level up when finding all treasures in a mine</li>
                                <li><strong>Effect:</strong> Increases the number of tiles the Bomb tool will mine</li>
                            </ul>

                            <h4>Cell Battery</h4>
                            <ul>
                                <li><strong>Progress:</strong> Gains progress to level up when the player uses discharge</li>
                                <li><strong>Effect:</strong> Triggers a discharge which will clear tiles in a certain pattern, new patterns become available by levelling up Cell Battery</li>
                            </ul>

                            <h4>Treasure Scanner</h4>
                            <ul>
                                <li><strong>Progress:</strong> Gains progress to level up when finding a treasure in a mine</li>
                                <li><strong>Effect:</strong> Has a chance to duplicate a collected treasure. Keeps attempting to duplicate until it fails a chance</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Battery</span>
                        </div>

                        <div class="card-body">
                            <p>
                                The Battery is a system that charges up as you or your expert mines tiles.
                            </p>
                            <p>
                                Each successful mining attempt will add 1 charge, up to a maximum of <knockout data-bind="text: GameConstants.UNDERGROUND_BATTERY_MAX_CHARGES"></knockout> charges.
                                You can only gain 1 charge per <knockout data-bind="text: GameConstants.UNDERGROUND_BATTERY_COOLDOWN_SECONDS"></knockout> second.
                                Equipping your Cell Battery Oak Item will reduce the maximum charges needed to discharge.
                            </p>
                            <p>
                                When your battery is fully charged up, you can discharge it. This discharge will leave a pattern of cleared tiles behind.
                                With higher level patterns, which damage more tiles, becoming available as you level up.
                            </p>

                            <table class="table table-sm table-striped">
                                <thead class="thead-dark">
                                <tr>
                                    <th class="text-center">Tier</th>
                                    <th data-bind="css: { 'd-none': App.game.underground.battery.patterns.every(pattern => pattern.canAccess()) }"></th>
                                    <th class="text-left">Name</th>
                                    <th class="text-left" data-bind="css: { 'd-none': App.game.underground.battery.patterns.every(pattern => pattern.canAccess()) }">Requirements</th>
                                    <th class="text-center">Chance</th>
                                    <th class="text-center">Discharges</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- ko foreach: App.game.underground.battery.patterns -->
                                <tr>
                                    <td class="vertical-middle text-center" data-bind="text: $data.tier"></td>
                                    <td class="vertical-middle" data-bind="css: { 'd-none': App.game.underground.battery.patterns.every(pattern => pattern.canAccess()) }">
                                        <img width="24px" class="lock" src="assets/images/breeding/lock.svg" data-bind="
                                            tooltip: {
                                                title: $data.hint || '',
                                                placement: 'bottom',
                                                trigger: 'hover'
                                            }, visible: !$data.canAccess()" />
                                    </td>
                                    <td class="vertical-middle text-left" data-bind="text: $data.name"></td>
                                    <td class="vertical-middle text-left" data-bind="text: !$data.canAccess() ? $data.hint : '', css: { 'd-none': App.game.underground.battery.patterns.every(pattern => pattern.canAccess()) }"></td>
                                    <td class="vertical-middle text-center" data-bind="text: $data.canAccess() ? ($data.weight / App.game.underground.battery.patterns.filter(p => p.canAccess()).reduce((prev, cur) => prev + cur.weight, 0)).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '-'"></td>
                                    <td class="vertical-middle text-center" data-bind="text: $data.canAccess() ? App.game.statistics.undergroundBatteryDischarges[$data.id]().toLocaleString('en-US') : '-'"></td>
                                </tr>
                                <!-- /ko -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Experts</span>
                        </div>

                        <div class="card-body">
                            <p>Experts are characters you can hire to assist with mining tasks. They perform actions at certain timing intervals and become more efficient as they level up. Each of them bring their own powerful tools, so their actions will not affect the durability of your tools.</p>

                            <h4>Expert Mechanics</h4>
                            <ul>
                                <li><strong>Expertise:</strong> Each expert has an expertise, a specific mine they are more likely to find.
                                    <ul>
                                        <li>Starts at <knockout data-bind="text: GameConstants.FAVORITE_MINE_CHANCE_BASE.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> chance to find their specific mine when searching.</li>
                                        <li>Increases by <knockout data-bind="text: GameConstants.FAVORITE_MINE_CHANCE_INCREASE_PER_LEVEL.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> per level, up to a maximum of <knockout data-bind="text: GameConstants.FAVORITE_MINE_CHANCE_MAXIMUM.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout>.</li>
                                        <li>If they don’t find their specific mine, they will find a <knockout data-bind="text: MineConfigs.find(MineType.Random).displayName"></knockout>.</li>
                                        <li><i>Experts will never discover a <knockout data-bind="text: MineConfigs.find(MineType.Special).displayName"></knockout>.</i></li>
                                    </ul>
                                </li>
                                <li><strong>Smart tool use:</strong> Experts start out inexperienced and will pick the most efficient tool <knockout data-bind="text: GameConstants.SMART_TOOL_CHANCE_BASE.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> of the time.
                                    <ul>
                                        <li>Increases by <knockout data-bind="text: GameConstants.SMART_TOOL_CHANCE_INCREASE_PER_LEVEL.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> per level, up to <knockout data-bind="text: GameConstants.SMART_TOOL_CHANCE_MAXIMUM.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout>.</li>
                                        <li>
                                            <strong>Actions</strong>
                                            <ul>
                                                <li><strong>Bomb:</strong> When not all treasures have been seen.</li>
                                                <li><strong>Hammer:</strong> When all treasures have been seen, and the spot that is being mined has at least 1 adjacent tile with a reward</li>
                                                <li><strong>Chisel:</strong> When all treasures have been seen, and the spot that is being mined has no adjacent tiles with a reward</li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li><strong>Reward retention:</strong> When an expert digs up a treasure (last click), there is a chance that they will keep the treasure for themselves.
                                    <ul>
                                        <li>
                                            The chance starts at <knockout data-bind="text: GameConstants.REWARD_RETENTION_BASE.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> and decreases by <knockout data-bind="text: GameConstants.REWARD_RETENTION_DECREASE_PER_LEVEL.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> per level, down to <knockout data-bind="text: GameConstants.REWARD_RETENTION_MINIMUM.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout>.
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <strong>Work cycle:</strong> Starts at <knockout data-bind="text: GameConstants.WORKCYCLE_TIMEOUT_BASE"></knockout> seconds and decreases by <knockout data-bind="text: GameConstants.WORKCYCLE_TIMEOUT_DECREASE_PER_LEVEL"></knockout> second for every level, up to a minimum of <knockout data-bind="text: GameConstants.WORKCYCLE_TIMEOUT_MINIMUM"></knockout> seconds per action.
                                </li>
                                <li>
                                    <strong>Energy restore:</strong> An expert can use an energy potion to restore a portion of the time until they can perform their next action. When an expert is allowed to use multiple restores they will first use the best restore at their disposal.
                                    <ul>
                                        <li><strong>Small restore:</strong> Restores 25% of the time until the next action can be performed</li>
                                        <li><strong>Medium restore:</strong> Restores 50% of the time until the next action can be performed</li>
                                        <li><strong>Large restore:</strong> Restores 75% of the time until the next action can be performed</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Experience and Leveling</span>
                        </div>

                        <div class="card-body">
                            <p>Using tools and experts not only helps you gather treasures but also grants experience that helps in leveling up.</p>

                            <h4>Experience</h4>
                            <ul>
                                <li>
                                    <strong>Treasures:</strong>
                                    <ul>
                                        <li>Digging up any treasure: <knockout data-bind="text: GameConstants.UNDERGROUND_EXPERIENCE_DIG_UP_ITEM"></knockout> experience</li>
                                        <li>Digging up all treasures: <knockout data-bind="text: GameConstants.UNDERGROUND_EXPERIENCE_CLEAR_LAYER"></knockout> experience</li>
                                    </ul>
                                </li>
                            </ul>

                            <h4>Shared Experience</h4>
                            <ul>
                                <li><strong>Player Actions:</strong> When the player performs an action that gains experience, the active expert will also gain <knockout data-bind="text: GameConstants.PLAYER_EXPERIENCE_HELPER_FRACTION.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> of that experience, rounded to the nearest tenth.</li>
                                <li><strong>Expert Actions:</strong> When the expert performs an action that gains them experience, the player will also gain <knockout data-bind="text: GameConstants.HELPER_EXPERIENCE_PLAYER_FRACTION.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> of that experience, rounded to the nearest tenth.</li>
                            </ul>

                            <h4>Underground Level</h4>
                            <p>Your underground level will affect the following:</p>
                            <ul>
                                <li>Increases the minimum and maximum amount of treasures that can be found in a mine</li>
                                <li>Increases the rate at which tools gain durability</li>
                                <li>Reduces the discovery time of mines when applicable</li>
                                <li>Reduces the Survey area</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Trading</span>
                        </div>

                        <div class="card-body">
                            <p>Trading allows you to exchange treasures within the same category. Here’s how it works:</p>
                            <ul>
                                <li><strong>Same Category Trading:</strong> Trades can only be made within the same category of treasures.</li>
                                <li><strong>3 to 1 Trade:</strong> Trading always follows a 3 to 1 ratio (e.g., trade 3 treasures to receive 1 new treasure).</li>
                                <li><strong>Exception:</strong> Diamond treasures cannot be traded for other items, only sold for diamonds.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Glossary</span>
                        </div>

                        <div class="card-body">
                            <ul>
                                <li><strong>Seen treasure:</strong> At least 1 part of the treasure is visible to the player</li>
                                <li><strong>Collected treasure:</strong> All parts of the treasure are visible to the player, the treasure has been claimed</li>
                                <li><strong>Completed Mine:</strong> All buried treasures have been collected</li>
                                <li><strong>Successful Tool Use:</strong> A tool only counts as used if its action is successful, meaning it accomplishes its intended task (e.g., mining layers or indicating tiles)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer p-0">
                <div class="container">
                    <div class="row p-0">
                        <!-- ko foreach: App.game.underground.helpers.hired() -->
                        <div class="col p-0">
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="d-flex align-items-center position-relative m-2">
                                    <!-- ko foreach: $data.images -->
                                    <img class="pixelated" data-bind="attr: { src: $data }" src="" alt="">
                                    <!-- /ko -->
                                    <!-- ko if: $data.hasStolenItem(600) -->
                                    <img class="pixelated position-absolute" src="assets/images/pokemon/25.23.png" alt="" style="width: 24px; right: -16px; bottom: -10px;">
                                    <!-- /ko -->
                                </div>

                                <div class="d-flex flex-wrap align-items-center m-2">
                                    <div>
                                        <div style="line-height: 1.2rem;" data-bind="text: $data.name"></div>
                                        <div style="font-size: 0.6rem; line-height: 0.5rem;" data-bind="text: `Level ${$data.level}`"></div>
                                    </div>
                                    <!-- ko ifnot: $data.selectedEnergyRestore() < 0 -->
                                    <img class="pixelated" data-bind="attr: { src: ItemList[GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore()]].image }" src="" alt="" style="height: 26px;">
                                    <span data-bind="text: `× ${player.itemList[GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore()]]().toLocaleString('en-US')}`"></span>
                                    <!-- /ko -->
                                </div>
                            </div>
                            <div class="progress" style='height: 5px'>
                                <div class="progress-bar bg-info" role="progressbar"
                                     data-bind="attr:{ style: 'width:' + ($data.timeSinceWork / $data.workCycleTime).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                                     aria-valuemin="0" aria-valuemax="100">
                                    <span data-bind="text: `${$data.timeSinceWork.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })} / ${$data.workCycleTime.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })} s`"></span>
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div aria-labelledby="findNewMineModalLabel" class="modal fade no-select" id="findNewMineModal" role="dialog" style="cursor: default;" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <h4>Select a mine</h4>
                <div class="search-mine-display mb-2">
                    <!-- ko foreach: [MineType.Random, MineType.Diamond, MineType.GemPlate, MineType.Shard, MineType.Fossil, MineType.EvolutionItem] -->
                    <div class="card clickable" data-bind="click: () => { App.game.underground.autoSearchMineType = $data; }">
                        <div class="card-body bg-secondary rounded text-center p-1" data-bind="css: { 'bg-info': App.game.underground.autoSearchMineType === $data }">
                            <div class="d-flex flex-column align-items-center p-1">
                                <h6 class="card-title m-0" data-bind="text: UndergroundController.getMineConfig($data).displayName"></h6>
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->
                </div>

                <div class="card mb-2">
                    <div class="card-header d-flex flex-column align-items-center p-2 text-center">
                        <div class="font-weight-bold" data-bind="text: UndergroundController.getMineConfig(App.game.underground.autoSearchMineType).displayName"></div>
                        <div class="small" data-bind="text: `${App.game.statistics.undergroundSpecificLayersMined[App.game.underground.autoSearchMineType]().toLocaleString('en-US')} clears`"></div>
                    </div>

                    <div class="card-body">
                        <h6>Potential treasures</h6>
                        <div>
                            <!-- ko foreach: UndergroundController.getMineConfig(App.game.underground.autoSearchMineType).getAvailableItems() -->
                            <img width="24px" height="24px" data-bind="tooltip: { title: $data.displayName, trigger: 'hover' }, attr: { src: $data.image }" />
                            <!-- /ko -->
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="small">
                            Discovery time: <label data-bind="text: GameConstants.formatTime(UndergroundController.calculateDiscoverMineTimeout(App.game.underground.autoSearchMineType)), css: { 'text-warning': UndergroundController.calculateDiscoverMineTimeout(App.game.underground.autoSearchMineType) > 0 }"></label>
                        </div>

                        <button class="btn btn-primary" data-bind="click: () => App.game.underground.generateMine(App.game.underground.autoSearchMineType);" data-dismiss="modal">Search for mine</button>
                    </div>
                </div>

                <div>
                    <!-- ko let: { autoRestartUndergroundMine: Settings.getSetting('autoRestartUndergroundMine') } -->
                    <label for="auto-restart-underground-mine" data-bind="text: autoRestartUndergroundMine.displayName"></label>
                    <label class="form-check-label toggler-wrapper style-1 float-right">
                        <input class="form-check-input" type="checkbox" id="auto-restart-underground-mine"
                               data-bind="checked: autoRestartUndergroundMine.observableValue">
                        <div class="toggler-slider">
                            <div class="toggler-knob"></div>
                        </div>
                    </label>
                    <!-- /ko -->
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<div aria-labelledby="treasureDetailModalLabel" class="modal fade no-select" id="treasureDetailModal" role="dialog" style="cursor: default;" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header align-items-center">
                <!-- ko if: UndergroundTrading.selectedTradeFromItem -->
                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                <div>
                    <h4 class="m-0" data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></h4>
                </div>
                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                <!-- /ko -->
            </div>

            <div class="modal-body" style="min-height: 300px;">
                <!-- ko if: UndergroundTrading.selectedTradeFromItem?.hasSellValue() -->
                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold">Sell</span>
                    </div>

                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 col-lg-3 font-weight-bold" data-bind="css: { 'text-danger': UndergroundTrading.sellAmount > player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() }">
                                <label data-bind="text: UndergroundTrading.sellAmount.toLocaleString('en-US')"></label>
                            </div>
                            <div class="col-12 col-lg-6">
                                <label data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></label>
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                                →
                                <!-- ko if: UndergroundTrading.selectedTradeFromItem.valueType === UndergroundItemValueType.Gem -->
                                <img class='mineInventoryItem' data-bind='attr: { src: Gems.image(UndergroundTrading.selectedTradeFromItem.type) }'/>
                                <label data-bind="text: `${UndergroundTrading.selectedTradeFromItem.value.toLocaleString('en-US')} × ${PokemonType[UndergroundTrading.selectedTradeFromItem.type]} Gems`"></label>
                                <!-- /ko -->
                                <!-- ko if: UndergroundTrading.selectedTradeFromItem.valueType === UndergroundItemValueType.Diamond -->
                                <img class='mineInventoryItem' src="assets/images/currency/diamond.svg"/>
                                <label data-bind="text: `${UndergroundTrading.selectedTradeFromItem.value.toLocaleString('en-US')} × Diamonds`"></label>
                                <!-- /ko -->
                            </div>
                            <div class="col-12 col-lg-3 font-weight-bold">
                                <label data-bind="text: (UndergroundTrading.sellAmount * UndergroundTrading.selectedTradeFromItem.value).toLocaleString('en-US')"></label>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="row">
                            <div class="col-12 col-lg-9 mb-2 mb-lg-0">
                                <div class="input-group">
                                    <button class="btn btn-warning btn-outline-dark smallButton smallFont" data-bind="click: () => UndergroundTrading.sellAmount = 1">Reset</button>

                                    <input type="number" min="0" class="outline-dark form-control form-control-number" data-bind="textInput: UndergroundTrading.sellAmount">

                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'original' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 10">
                                        +10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 100">
                                        +100
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'multiplication' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount *= 10">
                                        &times;10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount /= 10">
                                        &div;10
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'bigplus' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 100">
                                        +100
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 1000">
                                        +1,000
                                    </button>
                                    <!-- /ko -->

                                    <button class="btn btn-outline-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                                    <div class="dropdown-menu text-center p-0">
                                        <p class="small py-2 m-0">Set Trade Amount</p>
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [10, 100, 1000] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US')}`,
                                            click: () => { UndergroundTrading.sellAmount = $data }
                                        "></button>
                                        <!-- /ko -->
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [0.1, 0.25, 0.5, 0.75, 1] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US', { style: 'percent' })}`,
                                            click: () => { UndergroundTrading.sellAmount = player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() * $data }
                                        "></button>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-3">
                                <button class="btn btn-block btn-primary" data-bind="
                                    enable: UndergroundTrading.canSell,
                                    click: () => UndergroundTrading.sell()
                                ">Sell</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /ko -->

                <!-- ko if: UndergroundTrading.tradeToItemList?.length > 0 -->
                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold">Trade</span>
                    </div>

                    <div class="card-body">
                        <div class="justify-content-center treasure-item-container" data-bind="css: Settings.getSetting('undergroundTreasureViewMode').observableValue()">
                            <!-- ko foreach: UndergroundTrading.tradeToItemList -->
                            <div data-bind="
                                    template: { name: 'undergroundTreasureItemTemplate', data: { undergroundItem: $data, highlight: UndergroundTrading.selectedTradeToItem === $data } },
                                    click: () => {
                                        if ($data.isUnlocked()) {
                                            UndergroundTrading.selectedTradeToItem = $data
                                        }
                                    }
                                "></div>
                            <!-- /ko -->
                        </div>

                        <hr>

                        <div class="row">
                            <div class="col-12 col-lg-3 font-weight-bold" data-bind="css: { 'text-danger': UndergroundTrading.tradeFromAmount > player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() }">
                                <label data-bind="text: UndergroundTrading.tradeFromAmount.toLocaleString('en-US')"></label>
                            </div>
                            <div class="col-12 col-lg-6">
                                <label data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></label>
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                                →
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeToItem?.image || null }'>
                                <label data-bind="text: UndergroundTrading.selectedTradeToItem?.name || '???'"></label>
                            </div>
                            <div class="col-12 col-lg-3 font-weight-bold">
                                <label data-bind="text: UndergroundTrading.tradeAmount.toLocaleString('en-US')"></label>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="row">
                            <div class="col-12 col-lg-9 mb-2 mb-lg-0">
                                <div class="input-group">
                                    <button class="btn btn-warning btn-outline-dark smallButton smallFont" data-bind="click: () => UndergroundTrading.tradeAmount = 1">Reset</button>

                                    <input type="number" min="0" class="outline-dark form-control form-control-number" data-bind="textInput: UndergroundTrading.tradeAmount">

                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'original' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 10">
                                        +10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 100">
                                        +100
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'multiplication' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount *= 10">
                                        &times;10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount /= 10">
                                        &div;10
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'bigplus' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 100">
                                        +100
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 1000">
                                        +1,000
                                    </button>
                                    <!-- /ko -->

                                    <button class="btn btn-outline-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                                    <div class="dropdown-menu text-center p-0">
                                        <p class="small py-2 m-0">Set Trade Amount</p>
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [10, 100, 1000] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US')}`,
                                            click: () => { UndergroundTrading.tradeAmount = $data }
                                        "></button>
                                        <!-- /ko -->
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [0.1, 0.25, 0.5, 0.75, 1] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US', { style: 'percent' })}`,
                                            click: () => { UndergroundTrading.tradeFromAmount = player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() * $data }
                                        "></button>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-3">
                                <button class="btn btn-block btn-primary" data-bind="
                                    enable: UndergroundTrading.canTrade,
                                    click: () => UndergroundTrading.trade()
                                ">Trade</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /ko -->

                <!-- ko if: UndergroundTrading.selectedTradeFromItem -->
                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold">Statistics</span>
                    </div>

                    <div class="card-body">
                        <div class="row">
                            <div class="col-12">
                                <table class="table table-striped table-hover table-bordered table-sm m-0 mb-2">
                                    <thead>
                                    <tr class="bg-secondary">
                                        <th colspan="2">Mining</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td class="text-left">Owned</td>
                                        <td class="text-left tight"><code data-bind="text: player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]().toLocaleString('en-US')"></code></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Mined</td>
                                        <td class="text-left tight"><code data-bind="text: App.game.statistics.undergroundSpecificItemsFound[UndergroundTrading.selectedTradeFromItem.id]().toLocaleString('en-US')"></code></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /ko -->
            </div>

            <div class="modal-footer justify-content-between">
                <!-- ko if: UndergroundTrading.selectedTradeFromItem -->
                <div>Owned: <knockout data-bind="text: player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]().toLocaleString('en-US')"></knockout></div>
                <!-- /ko -->
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="undergroundTreasureItemTemplate">
<!-- ko let: { itemName: undergroundItem.itemName } -->
    <div class="btn btn-secondary w-100 h-100 p-1 position-relative overflow-hidden" data-bind="
        enable: undergroundItem.isUnlocked(),
        css: {
            'has-sell-value': undergroundItem.hasSellValue(),
            disabled: !undergroundItem.isUnlocked(),
            'bg-info': highlight
        }
    ">
        <div class="treasure-item" data-bind="style: { opacity: undergroundItem.isUnlocked() ? 1 : 0.25 },
            tooltip: {
                title: `<u>${ItemList[itemName].displayName}</u><br/>${ItemList[itemName].description}<br/>${player.itemList[itemName]().toLocaleString('en-US')}`,
                trigger: 'hover',
                html: true
            }
        ">
            <img width="42px" data-bind="attr: { src: ItemList[itemName].image }" />
            <div class="treasure-item-data-wrapper">
                <div class="treasure-item-name small" style="line-height: 1rem;" data-bind="text: ItemList[itemName].displayName"></div>
                <div class="small font-weight-bold short-format" style="line-height: 1rem; word-break: break-all" data-bind="text: GameConstants.formatNumber(player.itemList[itemName]())"></div>
                <div class="small font-weight-bold long-format" style="line-height: 1rem; word-break: break-all" data-bind="text: player.itemList[itemName]().toLocaleString('en-US')"></div>
            </div>
        </div>

        <!-- ko ifnot: undergroundItem.isUnlocked() -->
        <div class="d-flex justify-content-center align-items-center position-absolute" style="background-color: rgba(255, 255, 255, 0.5); inset: 0;" data-bind="
            tooltip: {
                title: undergroundItem.requirement?.hint() ?? '',
                trigger: 'hover'
            }
        ">
            <img width="24px" class="lock" src="assets/images/breeding/lock.svg" />
        </div>
        <!-- /ko -->
    </div>
<!-- /ko -->
</script>
