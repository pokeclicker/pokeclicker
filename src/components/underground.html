<div aria-labelledby="myModalLabel" class="modal fade noselect" id="mineModal" role="dialog"
     style="cursor:default" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header p-0">
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#dig">Dig</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#treasures">Treasures</a></li>
                    <li class="nav-item"><a data-toggle="tab" class="nav-link" href="#trading">Trading</a></li>
                    <li class="nav-item"><a data-toggle='tab' class='nav-link' href="#undergroundHelpers">Helpers</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#help">Help</a></li>
                    <li class="d-lg-block d-none"><button type="button" class="btn btn-danger" data-dismiss="modal" style="font-size: 18px; font-weight: 700;">×</button></li>
                </ul>
            </div>
            <div class="modal-body tab-content p-0">
                <div id="dig" class="tab-pane fade in active show" data-bind="">
                    <div class="container">
                        <div class="row">
                            <div class="col-6">
                                <!-- ko if: App.game.underground.mine -->
                                    <!-- ko if: App.game.underground.mine.timeUntilDiscovery > 0 -->
                                    <div>Time until discovery</div>
                                    <div data-bind="text: GameConstants.formatTime(App.game.underground.mine.timeUntilDiscovery)"></div>
                                    <!-- /ko -->

                                    <!-- ko ifnot: App.game.underground.mine.timeUntilDiscovery > 0 -->
                                    <div>Time since discovery</div>
                                    <div data-bind="text: GameConstants.formatTime(-1 * App.game.underground.mine.timeUntilDiscovery)"></div>
                                    <!-- /ko -->
                                <!-- /ko -->

                                <!-- ko ifnot: App.game.underground.mine -->
                                <div>No active mine</div>
                                <!-- /ko -->
                            </div>

                            <div class="col-6" data-bind="tooltip: {
                                    title: `${(App.game.underground.undergroundExp - Underground.convertLevelToExperience(App.game.underground.undergroundLevel)).toLocaleString('en-US')} / ${(Underground.convertLevelToExperience(App.game.underground.undergroundLevel + 1) - Underground.convertLevelToExperience(App.game.underground.undergroundLevel)).toLocaleString('en-US')}`,
                                    trigger: 'hover'
                                }">
                                <div>Lvl. <knockout data-bind="text: App.game.underground.undergroundLevel"></knockout></div>
                                <div class="progress" style='height: 5px'>
                                    <div class="progress-bar bg-info" role="progressbar"
                                         data-bind="attr:{ style: 'width:' + App.game.underground.progressToNextLevel.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                         aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <!-- ko if: App.game.underground.mine -->
                        <div id="mineBody" style="margin:auto; background-image: url('../assets/images/underground/rock0.png');"
                             data-bind="css: { 'disabled': App.game.underground.mine.timeUntilDiscovery > 0 || App.game.underground.mine.completed },
                             class: `${UndergroundToolType[App.game.undergroundTools.selectedToolType]}Selected`,
                             style: {
                                backgroundSize: `calc(100% / ${App.game.underground.mine?.columnCount})`,
                             },
                             foreach: App.game.underground.mine.grid">
                            <div class="mineSquare" data-bind="click: () => { UndergroundController.clickModalMineSquare($index()); }">
                                <div class="rock" data-bind="class: `rock${$data.layerDepth}`, style: UndergroundController.calculateMineTileStyle($index())"></div>

                                <!-- ko if: $data.survey > 0 -->
                                <div class="survey" data-bind="class: `survey-${$data.survey}`"></div>
                                <!-- /ko -->
                            </div>
                        </div>
                        <div class='row no-gutters'>
                            <div class="col-12" data-bind="text: 'Treasures found: ' + App.game.underground.mine?.itemsFound + ' / ' + App.game.underground.mine?.itemsBuried + ', Partially discovered: ' + App.game.underground.mine?.itemsPartiallyFound">
                            </div>

                            <div class="col-12 row no-gutters">
                                <div class="col mx-1 card clickable" data-bind="click: () => App.game.undergroundTools.selectedToolType = UndergroundToolType.Chisel">
                                    <div class="card-body bg-secondary rounded text-center p-1" data-bind="css: { 'bg-info': App.game.undergroundTools.selectedToolType === UndergroundToolType.Chisel }">
                                        <div class="d-flex flex-column align-items-center">
                                            <img src="../assets/images/underground/Chisel.png" alt="">
                                            <div>Chisel</div>
                                            <div>Free uses: <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Chisel).storedUses"></knockout></div>
                                            <div>Cooldown: <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Chisel).cooldownForDisplay().toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></div>
                                            <div><knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Chisel).counter.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout> / <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Chisel).baseCooldown"></knockout></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col mx-1 card clickable" data-bind="click: () => App.game.undergroundTools.selectedToolType = UndergroundToolType.Hammer">
                                    <div class="card-body bg-secondary rounded text-center p-1" data-bind="css: { 'bg-info': App.game.undergroundTools.selectedToolType === UndergroundToolType.Hammer }">
                                        <div class="d-flex flex-column align-items-center">
                                            <img src="../assets/images/underground/Hammer.png" alt="">
                                            <div>Hammer</div>
                                            <div>Free uses: <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Hammer).storedUses"></knockout></div>
                                            <div>Cooldown: <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Hammer).cooldownForDisplay().toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></div>
                                            <div><knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Hammer).counter.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout> / <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Hammer).baseCooldown"></knockout></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col mx-1 card clickable" data-bind="click: () => App.game.undergroundTools.selectedToolType = UndergroundToolType.Bomb">
                                    <div class="card-body bg-secondary rounded text-center p-1" data-bind="css: { 'bg-info': App.game.undergroundTools.selectedToolType === UndergroundToolType.Bomb }">
                                        <div class="d-flex flex-column align-items-center">
                                            <img src="../assets/images/underground/Bomb.png" alt="">
                                            <div>Bomb</div>
                                            <div>Free uses: <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Bomb).storedUses"></knockout></div>
                                            <div>Cooldown: <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Bomb).cooldownForDisplay().toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></div>
                                            <div><knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Bomb).counter.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout> / <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Bomb).baseCooldown"></knockout></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col mx-1 card clickable" data-bind="click: () => App.game.undergroundTools.selectedToolType = UndergroundToolType.Survey">
                                    <div class="card-body bg-secondary rounded text-center p-1" data-bind="css: { 'bg-info': App.game.undergroundTools.selectedToolType === UndergroundToolType.Survey }">
                                        <div class="d-flex flex-column align-items-center">
                                            <img src="../assets/images/underground/Survey.png" alt="">
                                            <div>Survey</div>
                                            <div>Free uses: <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Survey).storedUses"></knockout></div>
                                            <div>Cooldown: <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Survey).cooldownForDisplay().toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></div>
                                            <div><knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Survey).counter.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout> / <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Survey).baseCooldown"></knockout></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>

                    <div class="container">
                        <h4>Search new mine</h4>
                        <div class="search-mine-display">
                            <div class="mx-1 mb-1">
                                <div class="card clickable" data-bind="click: () => App.game.underground.generateMine();">
                                    <div class="card-body bg-secondary rounded text-center p1">
                                        <div class="d-flex flex-column align-items-center">
                                            <div style="width: 32px; height: 32px;">?</div>
                                            <div data-bind="text: GameConstants.formatTime(UndergroundController.calculateDiscoverMineTimeout())"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mx-1 mb-1">
                                <div class="card clickable" data-bind="click: () => App.game.underground.generateMine(MineType.Diamond);">
                                    <div class="card-body bg-secondary rounded text-center p1">
                                        <div class="d-flex flex-column align-items-center">
                                            <img style="width: 32px; height: 32px;" src="../assets/images/items/underground/Heart%20Scale.png" alt="">
                                            <div data-bind="text: GameConstants.formatTime(UndergroundController.calculateDiscoverMineTimeout(MineType.Diamond))"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mx-1 mb-1">
                                <div class="card clickable" data-bind="click: () => App.game.underground.generateMine(MineType.GemPlate);">
                                    <div class="card-body bg-secondary rounded text-center p1">
                                        <div class="d-flex flex-column align-items-center">
                                            <img style="width: 32px; height: 32px;" src="../assets/images/items/underground/Blank%20Plate.png" alt="">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mx-1 mb-1">
                                <div class="card clickable" data-bind="click: () => App.game.underground.generateMine(MineType.Shard);">
                                    <div class="card-body bg-secondary rounded text-center p1">
                                        <div class="d-flex flex-column align-items-center">
                                            <img style="width: 32px; height: 32px;" src="../assets/images/items/underground/White%20Shard.png" alt="">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mx-1 mb-1">
                                <div class="card clickable" data-bind="click: () => App.game.underground.generateMine(MineType.Fossil);">
                                    <div class="card-body bg-secondary rounded text-center p1">
                                        <div class="d-flex flex-column align-items-center">
                                            <img style="width: 32px; height: 32px;" src="../assets/images/breeding/Helix%20Fossil.png" alt="">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mx-1 mb-1">
                                <div class="card clickable" data-bind="click: () => App.game.underground.generateMine(MineType.EvolutionItem);">
                                    <div class="card-body bg-secondary rounded text-center p1">
                                        <div class="d-flex flex-column align-items-center">
                                            <img style="width: 32px; height: 32px;" src="../assets/images/items/evolution/Fire_stone.png" alt="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

<!--                    <div>-->
<!--                        <div>-->
<!--                            <button onclick='UndergroundController.addPlayerUndergroundExp(10)'>+10 XP</button>-->
<!--                            <button onclick='UndergroundController.addPlayerUndergroundExp(100)'>+100 XP</button>-->
<!--                            <button onclick='UndergroundController.addPlayerUndergroundExp(1000)'>+1,000 XP</button>-->
<!--                            <button onclick='UndergroundController.addPlayerUndergroundExp(10000)'>+10,000 XP</button>-->
<!--                            <button onclick='UndergroundController.addPlayerUndergroundExp(-10)'>-10 XP</button>-->
<!--                            <button onclick='UndergroundController.addPlayerUndergroundExp(-100)'>-100 XP</button>-->
<!--                            <button onclick='UndergroundController.addPlayerUndergroundExp(-1000)'>-1,000 XP</button>-->
<!--                            <button onclick='UndergroundController.addPlayerUndergroundExp(-10000)'>-10,000 XP</button>-->
<!--                        </div>-->
<!--                    </div>-->
                </div>

                <div id="treasures" class="tab-pane fade">
                </div>

                <div id="trading" class="tab-pane fade">
<!--                    <div data-bind="foreach: UndergroundTrading.availableItemsToTrade">-->
<!--                        <div data-bind="text: $data.itemName"></div>-->
<!--                    </div>-->

                    <div class="input-group input-group-sm">
                        <select autocomplete="off" class="custom-select" data-bind="options: [
                            { name: 'None', value: null },
                            ...UndergroundTrading.availableItemsToTrade.map(i => ({ name: i.name, value: i })),
                        ], optionsValue: 'value', optionsText: 'name', value: UndergroundTrading.selectedTradeFromItem"></select>
                    </div>


                    <div class="input-group input-group-sm">
                        <select autocomplete="off" class="custom-select" data-bind="options: [
                            { name: 'None', value: null },
                            ...UndergroundTrading.tradeToItemList.map(i => ({ name: i.name, value: i })),
                        ], optionsValue: 'value', optionsText: 'name', value: UndergroundTrading.selectedTradeToItem"></select>
                    </div>
                </div>

                <div id="undergroundHelpers" class="tab-pane fade">
                    <div class="row m-0 justify-content-start" data-bind="foreach: App.game.underground.helpers.available()" style="max-width: 100%;">
                        <div class="card text-left col-md-3 col-sm-6 col-xs-12 p-0">
                            <h5 class="card-header">
                                <knockout data-bind="text: $data.name">Name</knockout>
                            </h5>
                            <div class="card-body p-0">
                                <table class="table table-striped table-hover table-bordered table-sm m-0">
                                    <thead>
                                    <tr>
                                        <th colspan="2" class="text-center text-light bg-dark"><h5 class="m-0">Information</h5></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td class="text-left">Level</td>
                                        <td class="text-right tight" data-bind="text: $data.level.toLocaleString('en-US')"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Experience</td>
                                        <td class="text-right tight" data-bind="text: $data.experience.toLocaleString('en-US')"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Auto-sell</td>
                                        <td class="text-right tight" data-bind="text: $data.autoSellValue.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Smart tool</td>
                                        <td class="text-right tight" data-bind="text: $data.smartToolUsageChance.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Favorite mine</td>
                                        <td class="text-right tight" data-bind="text: $data.favoriteMine"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Discover chance</td>
                                        <td class="text-right tight" data-bind="text: $data.favoriteMineChance.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Work cycle</td>
                                        <td class="text-right tight" data-bind="text: `${$data.workCycleTime.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })}s`"></td>
                                    </tr>
                                    </tbody>

                                    <thead>
                                    <tr>
                                        <th colspan="2" class="text-center text-light bg-dark"><h5 class="m-0">Energy Restore</h5></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td colspan="2">
                                            <div class="input-group input-group-sm">
                                                <select autocomplete="off" class="custom-select" data-bind="options: [
                                                    { name: 'None', value: -1 },
                                                    ...GameHelper.enumSelectOption(GameConstants.EnergyRestoreSize),
                                                ], optionsValue: 'value', optionsText: (item) => item.value < 0 ? `${GameConstants.camelCaseToString(item.name)}` : `${GameConstants.camelCaseToString(item.name)} (${player.itemList[item.name]().toLocaleString('en-US')})`, value: $data.selectedEnergyRestore"></select>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="card-footer p-0">
                                <button class="btn btn-block" data-bind="attr: { disabled: !$data.hired && !App.game.underground.helpers.canHire() }, css: { 'btn-success': !$data.hired, 'btn-danger': $data.hired }, click: () => !$data.hired ? $data.hire() : $data.fire(), text: !$data.hired ? 'Hire!' : 'Fire!'">Hire!</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="help" class="tab-pane fade pl-5 pr-5">
                    <h4><u>Dig</u></h4>
                    <p>In the Underground you can mine for hidden treasures.</p>

                    <p>There are three main ways of breaking tiles:
                    <br/>Chisel will mine 2 layers on a single tile.
                    <br/>Hammer will mine 1 layer on all nine tiles of a 3x3 square.
                    <br/>Bomb will mine 2 layers of 10 random tiles.</p>

                    <h4><u>Treasures</u></h4>
                    <p>Sell your treasures for gems or diamonds!</p>
                    <p>If you have found any fossils, you can hatch the Pokémon they contain from the Treasures tab, or from the Day Care.</p>

                    <h4><u>Daily deals</u></h4>
                    <p>In the Daily deals tab you can trade your items. The trades available change each day at midnight.</p>
                </div>
            </div>

            <div class="modal-footer">
                <div class="container">
                    <div class="row">
                        <!-- ko foreach: App.game.underground.helpers.hired() -->
                        <div class="col">
                            <div>
                                <span data-bind="text: $data.name"></span>
                                <!-- ko ifnot: $data.selectedEnergyRestore < 0 -->
                                <span data-bind="text: ` using ${GameConstants.camelCaseToString(GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore])} (${player.itemList[GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore]]().toLocaleString('en-US')})`"></span>
                                <!-- /ko -->
                            </div>
                            <div class="progress" style='height: 5px'>
                                <div class="progress-bar bg-info" role="progressbar"
                                     data-bind="attr:{ style: 'width:' + ($data.timeSinceWork / $data.workCycleTime).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                                     aria-valuemin="0" aria-valuemax="100">
                                </div>
                            </div>
                            <div data-bind="text: `${$data.timeSinceWork.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })}/${$data.workCycleTime.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })}s`"></div>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/html" id="treasureListTemplate">
        <tr>
        </tr>
    </script>
</div>

<div aria-labelledby="mineSellAllTreasuresModalLabel" class="modal fade noselect mt-5" id="mineSellAllTreasuresModal" role="dialog"
     style="cursor:default" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-sm" role="document" data-bind="let: { filteredMineInventory: UndergroundItems.list.filter(item => item.hasSellValue() && player.itemList[item.itemName]()) }">
        <div class="modal-content">
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

    <script type="text/html" id="cumulativeValueListTemplate">
        <tr></tr>
    </script>
</div>
